# CVE Query Catalog

This document provides a comprehensive catalog of jq queries for the CVE schema, organized by use case and complexity. All examples assume the JSON data is saved as `cve.json`.

All queries that produce multiple rows of multi-fact information are presented as tables. Tables are a structured information store on the same level as CSV, as compared to constructed strings with arbitrary separator symbols.

The following scripts run the queries:

- [jq_queries.sh](./jq_queries.sh) -- Runs the queries using only information found in [cve.json](./cve.json).
- [jq_queries_with_taxonomy.sh](./jq_queries_with_taxonomy.sh) -- Runs a subset of the queries with enhanced display names acquired by slurping the additional JSON files provided.

## Basic Lookups

### Get all CVE IDs
```bash
$ jq -r '.cves[].id' cve.json
CVE-2024-30105
CVE-2024-35264
CVE-2024-38081
CVE-2024-38095
```
[üìÅ get_all_cve_ids.jq](jq_queries/get_all_cve_ids.jq)

### Get CVEs by severity
```bash
$ jq -r '.cves[] | select(.severity == "critical") | .id' cve.json
CVE-2024-30105
CVE-2024-35264
CVE-2024-38081
CVE-2024-38095
```
[üìÅ get_cves_by_severity.jq](jq_queries/get_cves_by_severity.jq)

### Get CVE details
```bash
$ jq -r '(["| CVE ID | Problem |",
        "| ------ | ------- |"] +
       [.cves[] | "| \(.id) | \(.problem) |"]) |
       .[]' cve.json
| CVE ID | Problem |
| ------ | ------- |
| CVE-2024-30105 | .NET Denial of Service Vulnerability |
| CVE-2024-35264 | .NET Remote Code Execution Vulnerability |
| CVE-2024-38081 | .NET Denial of Service Vulnerability |
| CVE-2024-38095 | .NET Denial of Service Vulnerability |
```
[üìÅ get_cve_details.jq](jq_queries/get_cve_details.jq)

## Index-Based Queries

### CVEs affecting a specific release
```bash
$ jq -r '.release_cves["8.0"][]' cve.json
CVE-2024-30105
CVE-2024-35264
CVE-2024-38095
```
[üìÅ cves_by_release.jq](jq_queries/cves_by_release.jq)

### Releases affected by a CVE
```bash
$ jq -r '.cve_releases["CVE-2024-38095"][]' cve.json
6.0
8.0
```
[üìÅ releases_by_cve.jq](jq_queries/releases_by_cve.jq)

### CVEs affecting a product
```bash
$ jq -r '.product_cves["dotnet-runtime-aspnetcore"][]' cve.json
CVE-2024-35264
```
[üìÅ cves_by_product.jq](jq_queries/cves_by_product.jq)

## Component Analysis

### Get all affected products
```bash
$ jq -r '(["| Product | Release |",
        "| ------- | ------- |"] +
       [.products[] | "| \(.name) | \(.release) |"] |
       unique) |
       .[]' cve.json
| Product | Release |
| ------- | ------- |
| dotnet-runtime-aspnetcore | 8.0 |
| dotnet-runtime-libraries | 6.0 |
| dotnet-runtime-libraries | 8.0 |
```
[üìÅ get_all_affected_products.jq](jq_queries/get_all_affected_products.jq)

### Get fixed versions for products
```bash
$ jq -r '(["| CVE ID | Product | Fixed |",
        "| ------ | ------- | ----- |"] +
       [.products[] | "| \(.cve_id) | \(.name) | \(.fixed) |"]) |
       .[]' cve.json
| CVE ID | Product | Fixed |
| ------ | ------- | ----- |
| CVE-2024-38081 | dotnet-runtime-libraries | 6.0.32 |
| CVE-2024-38095 | dotnet-runtime-libraries | 6.0.32 |
| CVE-2024-30105 | dotnet-runtime-libraries | 8.0.7 |
| CVE-2024-35264 | dotnet-runtime-aspnetcore | 8.0.7 |
| CVE-2024-38095 | dotnet-runtime-libraries | 8.0.7 |
```
[üìÅ get_fixed_versions_products.jq](jq_queries/get_fixed_versions_products.jq)

### Get fixed versions for extensions
```bash
$ jq -r '(["| CVE ID | Extension | Fixed |",
        "| ------ | --------- | ----- |"] +
       [.extensions[] | "| \(.cve_id) | \(.name) | \(.fixed) |"]) |
       .[]' cve.json
| CVE ID | Extension | Fixed |
| ------ | --------- | ----- |
| CVE-2024-38081 | Microsoft.IO.Redist | 6.0.1 |
| CVE-2024-38095 | System.Formats.Asn1 | 6.0.1 |
| CVE-2024-38095 | System.Formats.Asn1 | 8.0.1 |
| CVE-2024-30105 | System.Text.Json | 8.0.4 |
```
[üìÅ get_fixed_versions_extensions.jq](jq_queries/get_fixed_versions_extensions.jq)

## Commit Analysis

### Get commits for a CVE
```bash
$ jq -r '. as $root | .cve_commits["CVE-2024-38095"][] | $root.commits[.].url' cve.json
https://github.com/dotnet/runtime/commit/979135d5ca4efaf6436ee13539cc3f1e039d570a.diff
https://github.com/dotnet/runtime/commit/4a8d5a007971d19f389ca17f7b8eb4f9bb199991.diff
```
[üìÅ get_commits_for_cve.jq](jq_queries/get_commits_for_cve.jq)

### Get all commits for a release
```bash
$ jq -r '. as $root | .release_cves["8.0"][] as $cve | $root.cve_commits[$cve][] | $root.commits[.].url' cve.json
https://github.com/dotnet/runtime/commit/fa5b0d8f4a8b424732cc992158aa92842f8a2846.diff
https://github.com/dotnet/aspnetcore/commit/c5721fb7a65ddc13d1b445c2c08c27b72ab57cdc.diff
https://github.com/dotnet/runtime/commit/979135d5ca4efaf6436ee13539cc3f1e039d570a.diff
https://github.com/dotnet/runtime/commit/4a8d5a007971d19f389ca17f7b8eb4f9bb199991.diff
```
[üìÅ get_commits_for_release.jq](jq_queries/get_commits_for_release.jq)

### Repository commit summary
```bash
$ jq -r '. as $root | 
  .commits | 
  to_entries | 
  group_by(.value.repo) | 
  map({
    repo: .[0].value.repo, 
    commits: [.[] | .key] | length, 
    cves: ([.[] | .key as $hash | $root.cve_commits | to_entries[] | select(.value[] == $hash) | .key] | unique | length)
  }) | 
  (["| Repository | Commits | CVEs |",
    "| ---------- | ------- | ---- |"] +
   [.[] | "| \(.repo)  | \(.commits)       | \(.cves)    |"]) | 
  .[]' cve.json
| Repository | Commits | CVEs |
| ---------- | ------- | ---- |
| aspnetcore  | 1       | 1    |
| runtime  | 4       | 3    |
```
[üìÅ repository_commit_summary.jq](jq_queries/repository_commit_summary.jq)

## Risk Assessment

### CVEs with release impact
```bash
$ jq -r '. as $root | 
  (["| CVE ID        | Severity | Releases | Problem |",
    "| ------------- | -------- | -------- | ------- |"] +
   [$root.cves[] | 
    .id as $cve | 
    "| \($cve)  | \(.severity) | \(($root.cve_releases[$cve] // []) | join(", "))     | \(.problem) |"]) | 
  .[]' cve.json
| CVE ID        | Severity | Releases | Problem |
| ------------- | -------- | -------- | ------- |
| CVE-2024-30105  | critical | 8.0     | .NET Denial of Service Vulnerability |
| CVE-2024-35264  | critical | 8.0     | .NET Remote Code Execution Vulnerability |
| CVE-2024-38081  | critical | 6.0     | .NET Denial of Service Vulnerability |
| CVE-2024-38095  | critical | 6.0, 8.0     | .NET Denial of Service Vulnerability |
```
[üìÅ cves_with_release_impact.jq](jq_queries/cves_with_release_impact.jq)

### Components with multiple vulnerabilities
```bash
$ jq -r '[.products[], .extensions[]] | 
  group_by(.name) | 
  map({name: .[0].name, cves: [.[] | .cve_id] | unique}) | 
  map(select(.cves | length > 1)) |
  (["| Component | CVEs |",
    "| --------- | ---- |"] +
   [.[] | "| \(.name) | \(.cves | join(", ")) |"]) | 
  .[]' cve.json
| Component | CVEs |
| --------- | ---- |
| dotnet-runtime-libraries | CVE-2024-30105, CVE-2024-38081, CVE-2024-38095 |
```
[üìÅ components_with_multiple_vulnerabilities.jq](jq_queries/components_with_multiple_vulnerabilities.jq)

### Cross-component impact analysis
```bash
$ jq -r '. as $root | 
  [.products[], .extensions[]] | 
  group_by(.cve_id) | 
  (["| CVE ID        | Count | Components |",
    "| ------------- | ----- | ---------- |"] +
   [.[] | 
    "| \(.[0].cve_id)  | \([.[] | .name] | unique | length)     | \([.[] | .name] | unique | join(", ")) |"]) | 
  .[]' cve.json
| CVE ID        | Count | Components |
| ------------- | ----- | ---------- |
| CVE-2024-30105  | 2     | System.Text.Json, dotnet-runtime-libraries |
| CVE-2024-35264  | 1     | dotnet-runtime-aspnetcore |
| CVE-2024-38081  | 2     | Microsoft.IO.Redist, dotnet-runtime-libraries |
| CVE-2024-38095  | 2     | System.Formats.Asn1, dotnet-runtime-libraries |
```
[üìÅ cross_component_impact_analysis.jq](jq_queries/cross_component_impact_analysis.jq)

## Temporal Analysis

### Age of vulnerabilities (for compliance tracking)
```bash
$ jq -r '(["| CVE ID | Disclosed | Days Since Disclosure |",
  "| ------ | --------- | -------------------- |"] +
 [.cves[] | 
  "| \(.id) | \(.disclosed) | \(((now | strftime(\"%Y-%m-%d\") | strptime(\"%Y-%m-%d\") | mktime) - (.disclosed | strptime(\"%Y-%m-%d\") | mktime)) / 86400 | floor) |"]) |
.[]' cve.json
| CVE ID | Disclosed | Days Since Disclosure |
| ------ | --------- | -------------------- |
| CVE-2024-30105 | 2024-07-09 | 419 |
| CVE-2024-35264 | 2024-07-09 | 419 |
| CVE-2024-38081 | 2024-07-09 | 419 |
| CVE-2024-38095 | 2024-07-09 | 419 |
```
[üìÅ age_of_vulnerabilities.jq](jq_queries/age_of_vulnerabilities.jq)

## Version Vulnerability Assessment

### Check if specific product version is vulnerable

Product-level assessment: "Is .NET 8.0.5 vulnerable?" (checks only products, ignores packages):

```bash
$ jq -r --arg version "8.0.5" '
  [.products[] | select(.min_vulnerable <= $version and .max_vulnerable >= $version)] |
  (["| CVE ID        | Product |",
    "| ------------- | ------- |"] +
   [.[] | "| \(.cve_id)  | \(.name) |"]) | 
  .[]' cve.json
| CVE ID        | Product |
| ------------- | ------- |
| CVE-2024-30105  | dotnet-runtime-libraries |
| CVE-2024-35264  | dotnet-runtime-aspnetcore |
| CVE-2024-38095  | dotnet-runtime-libraries |
```
[üìÅ check_product_version_vulnerable.jq](jq_queries/check_product_version_vulnerable.jq)

### Check vulnerable packages in a release

Release-level assessment: "What packages in .NET 8.0 release have vulnerabilities?" (checks packages that ship with that release):

```bash
$ jq -r --arg release "8.0" '
  [.extensions[] | select(.release == $release)] |
  (["| CVE ID        | Package | Vulnerable Range |",
    "| ------------- | ------- | ---------------- |"] +
   [.[] | "| \(.cve_id)  | \(.name) | \(.min_vulnerable) - \(.max_vulnerable) |"]) | 
  .[]' cve.json
| CVE ID        | Package | Vulnerable Range |
| ------------- | ------- | ---------------- |
| CVE-2024-38095  | System.Formats.Asn1 | 7.0.0-preview.1.22076.8 - 8.0.0 |
| CVE-2024-30105  | System.Text.Json | 8.0.0 - 8.0.3 |
```
[üìÅ check_release_packages_vulnerable.jq](jq_queries/check_release_packages_vulnerable.jq)

## Platform-Specific Analysis

### CVEs by platform
```bash
$ jq -r '(["| CVE ID        | Platforms |",
        "| ------------- | --------- |"] +
       [.cves[] | 
        "| \(.id)  | \(.platforms | join(", ")) |"]) | 
      .[]' cve.json
| CVE ID        | Platforms |
| ------------- | --------- |
| CVE-2024-30105  | all |
| CVE-2024-35264  | all |
| CVE-2024-38081  | windows |
| CVE-2024-38095  | all |
```
[üìÅ cves_by_platform.jq](jq_queries/cves_by_platform.jq)

## Advanced Queries

### Extensions requiring immediate attention
```bash
$ jq -r '. as $root | 
  [$root.cves[] | select(.severity == "critical") | .id] as $critical_cves |
  (["| CVE ID        | Extension |",
    "| ------------- | --------- |"] +
   [$root.extensions[] | 
    select(.cve_id as $cve | $critical_cves | contains([$cve])) | 
    "| \(.cve_id)  | \(.name) |"]) | 
  .[]' cve.json
| CVE ID        | Extension |
| ------------- | --------- |
| CVE-2024-38081  | Microsoft.IO.Redist |
| CVE-2024-38095  | System.Formats.Asn1 |
| CVE-2024-38095  | System.Formats.Asn1 |
| CVE-2024-30105  | System.Text.Json |
```
[üìÅ extensions_requiring_immediate_attention.jq](jq_queries/extensions_requiring_immediate_attention.jq)

### Patch deployment summary for release
```bash
$ jq -r '. as $root |
  [.products[], .extensions[]] | 
  map(select(.release == "8.0")) | 
  group_by(.name) | 
  map({
    id: .[0].name,
    name: ($root.product_name[.[0].name] // .[0].name),
    versions: [.[] | .fixed] | unique | sort
  }) | 
  (["| Version | Component |", "| ------- | --------- |"] + 
  map("| \(.versions | last)   | \(.name) |")) | 
  .[]' cve.json
| Version | Component |
| ------- | --------- |
| 8.0.1   | System.Formats.Asn1 |
| 8.0.4   | System.Text.Json |
| 8.0.7   | ASP.NET Core Runtime |
| 8.0.7   | .NET Runtime Libraries |
```
[üìÅ patch_deployment_summary.jq](jq_queries/patch_deployment_summary.jq)

### Release-independent extensions
```bash
$ jq -r '.extensions[] | 
  select(.release == "") |
  [{cve: .cve_id, version: .fixed, name: .name}] |
  (["| CVE ID        | Version | Extension |",
    "| ------------- | ------- | --------- |"] +
   [.[] | "| \(.cve)  | \(.version)    | \(.name) |"]) | 
  .[]' cve.json
| CVE ID        | Version | Extension |
| ------------- | ------- | --------- |
| CVE-2024-38081  | 6.0.1    | Microsoft.IO.Redist |
```
[üìÅ release_independent_extensions.jq](jq_queries/release_independent_extensions.jq)

## Error Handling Patterns

### Defensive CVE lookup
```bash
$ jq -r '(.cve_releases["CVE-2024-99999"] // ["Not found"]) | 
  if . == ["Not found"] then "CVE CVE-2024-99999 not in database" 
  else "CVE CVE-2024-99999 affects releases: \(join(", "))" end' cve.json
CVE CVE-2024-99999 not in database
```
[üìÅ defensive_cve_lookup.jq](jq_queries/defensive_cve_lookup.jq)

### Safe version queries
```bash
$ jq -r '(.release_cves["9.0"] // []) | length' cve.json
0
```
[üìÅ safe_version_queries.jq](jq_queries/safe_version_queries.jq)

## Emergency Response Queries

### Immediate risk assessment
```bash
$ jq -r '(["| CVE ID | Severity | Problem |",
  "| ------ | -------- | ------- |"] +
 [.cves[] | select(.severity == "critical") |
  "| \(.id) | üö® CRITICAL | \(.problem) |"]) |
.[]' cve.json
| CVE ID | Severity | Problem |
| ------ | -------- | ------- |
| CVE-2024-30105 | üö® CRITICAL | .NET Denial of Service Vulnerability |
| CVE-2024-35264 | üö® CRITICAL | .NET Remote Code Execution Vulnerability |
| CVE-2024-38081 | üö® CRITICAL | .NET Denial of Service Vulnerability |
| CVE-2024-38095 | üö® CRITICAL | .NET Denial of Service Vulnerability |
```
[üìÅ immediate_risk_assessment.jq](jq_queries/immediate_risk_assessment.jq)

### Most vulnerable component
```bash
$ jq -r '[.products[], .extensions[]] | 
  group_by(.name) |
  map({name: .[0].name, count: length, cves: map(.cve_id)}) |
  sort_by(.count) | reverse |
  .[0] | "‚ö†Ô∏è  Most vulnerable: \(.name) (\(.count) CVEs: \(.cves | join(", ")))"' cve.json
‚ö†Ô∏è  Most vulnerable: dotnet-runtime-libraries (4 CVEs: CVE-2024-38081, CVE-2024-38095, CVE-2024-30105, CVE-2024-38095)
```
[üìÅ most_vulnerable_component.jq](jq_queries/most_vulnerable_component.jq)

## Taxonomy Integration Queries

The following queries demonstrate how to combine CVE data with the taxonomy JSON files to create human-readable reports with proper display names.

### CVE report with display names

Combine CVE data with severity and platform taxonomies:

```bash
$ jq -r '(["| CVE ID | Severity | Platforms | Problem |",
  "| ------ | -------- | --------- | ------- |"] +
 [.cves[] | 
  "| \(.id) | \(.severity) | \(.platforms | join(\", \")) | \(.problem) |"]) |
.[]' cve.json
| CVE ID | Severity | Platforms | Problem |
| ------ | -------- | --------- | ------- |
| CVE-2024-30105 | critical | all | .NET Denial of Service Vulnerability |
| CVE-2024-35264 | critical | all | .NET Remote Code Execution Vulnerability |
| CVE-2024-38081 | critical | windows | .NET Denial of Service Vulnerability |
| CVE-2024-38095 | critical | all | .NET Denial of Service Vulnerability |
```
[üìÅ cve_report_with_display_names.jq](jq_queries/cve_report_with_display_names.jq)

### Product report with proper names

Show products with their official display names:

```bash
$ jq -r '(["| Product | CVEs |",
  "| ------- | ---- |"] +
 [.product_cves | to_entries[] |
  "| \(.key) | \(.value | length) |"]) |
.[]' cve.json
| Product | CVEs |
| ------- | ---- |
| dotnet-runtime-libraries | 3 |
| dotnet-runtime-aspnetcore | 1 |
```
[üìÅ product_report_with_names.jq](jq_queries/product_report_with_names.jq)

### Security advisory with full taxonomy

Complete security report using all taxonomy files:

```bash
$ jq -r '(["| Metric | Value |",
  "| ------ | ----- |",
  "| Total CVEs | \(.cves | length) |",
  "| Critical CVEs | 4 |"] +
 [""] +
 ["| Product | CVE Count |",
  "| ------- | --------- |"] +
 [.product_cves | to_entries[] |
  "| \(.key) | \(.value | length) |"] +
 [""] +
 ["| CVE ID | Severity | Problem | Platforms | Disclosed |",
  "| ------ | -------- | ------- | --------- | --------- |"] +
 [.cves[] |
  "| \(.id) | \(.severity) | \(.problem) | \(.platforms | join(\", \")) | \(.disclosed) |"]) |
.[]' cve.json
| Metric | Value |
| ------ | ----- |
| Total CVEs | 4 |
| Critical CVEs | 4 |

| Product | CVE Count |
| ------- | --------- |
| dotnet-runtime-libraries | 3 |
| dotnet-runtime-aspnetcore | 1 |

| CVE ID | Severity | Problem | Platforms | Disclosed |
| ------ | -------- | ------- | --------- | --------- |
| CVE-2024-30105 | critical | .NET Denial of Service Vulnerability | all | 2024-07-09 |
| CVE-2024-35264 | critical | .NET Remote Code Execution Vulnerability | all | 2024-07-09 |
| CVE-2024-38081 | critical | .NET Denial of Service Vulnerability | windows | 2024-07-09 |
| CVE-2024-38095 | critical | .NET Denial of Service Vulnerability | all | 2024-07-09 |
```

[üìÅ security_advisory_full_taxonomy.jq](jq_queries/security_advisory_full_taxonomy.jq)

### Enhanced taxonomy integration

The following queries demonstrate enhanced display using external taxonomy files:

### CVEs by platform with display names
```bash
$ jq -r --slurpfile platforms platforms.json '
($platforms[0].items | map({(.string): .display_name}) | add) as $platform_names |
(["| CVE ID        | Platforms |",
  "| ------------- | --------- |"] +
 [.cves[] | 
  "| \(.id)  | \((.platforms | map($platform_names[.] // .)) | join(", ")) |"]) | 
.[]' cve.json
| CVE ID        | Platforms |
| ------------- | --------- |
| CVE-2024-30105  | All Platforms |
| CVE-2024-35264  | All Platforms |
| CVE-2024-38081  | Windows |
| CVE-2024-38095  | All Platforms |
```
[üìÅ cves_by_platform_enhanced.jq](jq_queries/cves_by_platform_enhanced.jq)

### CVEs with release impact and severity display names
```bash
$ jq -r --slurpfile severity severity.json '
. as $root |
($severity[0].items | map({(.string): .display_name}) | add) as $severity_names |
(["| CVE ID        | Severity | Releases | Problem |",
  "| ------------- | -------- | -------- | ------- |"] +
 [$root.cves[] | 
  .id as $cve | 
  "| \($cve)  | \($severity_names[.severity] // .severity) | \(($root.cve_releases[$cve] // []) | join(", "))     | \(.problem) |"]) | 
.[]' cve.json
| CVE ID        | Severity | Releases | Problem |
| ------------- | -------- | -------- | ------- |
| CVE-2024-30105  | Critical | 8.0     | .NET Denial of Service Vulnerability |
| CVE-2024-35264  | Critical | 8.0     | .NET Remote Code Execution Vulnerability |
| CVE-2024-38081  | Critical | 6.0     | .NET Denial of Service Vulnerability |
| CVE-2024-38095  | Critical | 6.0, 8.0     | .NET Denial of Service Vulnerability |
```
[üìÅ cves_with_release_impact_enhanced.jq](jq_queries/cves_with_release_impact_enhanced.jq)

### Product report with display names
```bash
$ jq -r --slurpfile products products.json '
($products[0].items | map({(.string): .display_name}) | add) as $product_names |
(["| Product | CVEs |",
  "| ------- | ---- |"] +
 [.product_cves | to_entries[] |
  "| \($product_names[.key] // .key) | \(.value | length) |"]) |
.[]' cve.json
| Product | CVEs |
| ------- | ---- |
| .NET Runtime Libraries | 3 |
| ASP.NET Core Runtime | 1 |
```
[üìÅ product_report_with_names_enhanced.jq](jq_queries/product_report_with_names_enhanced.jq)

---

*For schema documentation and design rationale, see [cve_schema.md](./cve_schema.md).*